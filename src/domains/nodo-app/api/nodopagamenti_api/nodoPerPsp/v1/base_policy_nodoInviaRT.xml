<!-- @formatter:off -->
<policies>
    <inbound>
        <!-- operation before base policy -->
        <base />
        <!-- operation after base policy -->
        <include-fragment fragment-id="ndp-rpt-inbound-policy" />
        <include-fragment fragment-id="ndp-set-base-url-policy" />
    </inbound>
    <backend>
        <base />
    </backend>
    <outbound>
        <!-- operation before base policy -->
        <base />
        <!-- operation after base policy -->
        <set-variable name="nodo_fiscalCode_iuv_to_nav" value="@{
		  var fc_iuv_key = context.Variables.GetValueOrDefault<string>("nodo_fiscalCode_iuv_key", "NONE");
		  return fc_iuv_key + "_to_nav";
	  }" />
        <cache-lookup-value key="@(context.Variables.GetValueOrDefault<string>("nodo_fiscalCode_iuv_to_nav", "NONE"))" variable-name="nodo_fiscalCode_nav" default-value="NONE" caching-type="external" />
        <cache-remove-value key="@(context.Variables.GetValueOrDefault<string>("nodo_fiscalCode_iuv_key", "NONE"))" caching-type="external" />
        <cache-remove-value key="@(context.Variables.GetValueOrDefault<string>("nodo_fiscalCode_nav", "NONE"))" caching-type="external" />
        
        <!-- Trace variables dinamically as response headers -->
        <include-fragment fragment-id="trace-variable-as-header-policy" />
    </outbound>
    <on-error>
        <base />
    </on-error>
</policies>
