<fragment>
	<!-- ################################# -->
	<!-- START SPO-INBOUND-POLICY FRAGMENT -->
	<!-- ################################# -->

	<choose>

    <!-- If payment token is not found, APIM will call internal service that provide to forward this request to all Nodo instances -->
    <when condition="@(context.Variables.GetValueOrDefault<string>("nodo_paymentToken", "NONE").Equals("NONE"))">

			<trace source="forward_to_all_nodes_skipped">FORWARD_TO_ALL_NODES currently skipped</trace>

			<!-- !!!!!! INCLUDE THE CODE IN THESE COMMENTS WHEN NEW SERVICE WILL BE DEPLOYED !!!!!! -->
			<!-- Call internal service with received request -->
			<!--			<send-request mode="new" response-variable-name="merged_sendPaymentResult_response" timeout="8" ignore-error="false">-->
			<!--				<set-url>https://URL_TO_NEW_SERVICE_PLACEHOLDER</set-url>-->
			<!--				<set-method>POST</set-method>-->
			<!--				<set-header name="SOAPAction" exists-action="override">-->
			<!--					<value>@((string)context.Request.Headers.GetValueOrDefault("SOAPAction", ""))</value>-->
			<!--				</set-header>-->
			<!--				<set-body>@(context.Request.Body.As<XElement>(preserveContent: true).ToString())</set-body>-->
			<!--			</send-request>-->

			<!-- Return the response generated from internal service -->
			<!--			<return-response>-->
			<!--				<set-status code="@(((IResponse)context.Variables["merged_sendPaymentResult_response"]).StatusCode)" />-->
			<!--				<set-header name="Content-Type" exists-action="override">-->
			<!--					<value>text/xml</value>-->
			<!--				</set-header>-->
			<!--				<set-body>-->
			<!--					@{-->
			<!--						XElement response = ((IResponse)context.Variables["merged_sendPaymentResult_response"]).Body.As<XElement>(preserveContent: true);-->
			<!--						return response.ToString();-->
			<!--					}-->
			<!--				</set-body>-->
			<!--			</return-response>-->

  </when>

  <otherwise>
    <!-- do nothing -->
  </otherwise>
</choose>

	<!-- ############################### -->
	<!-- END SPO-INBOUND-POLICY FRAGMENT -->
	<!-- ############################### -->
</fragment>
